import{r,j as e,F as O}from"./app-DeyNhaIj.js";import{G as M}from"./GalleryController-DimcFaM-.js";import{D as q,b as z,a as B,c as H,d as J,e as X,f as Z,g as K}from"./dialog-VLgjrFb4.js";import{B as p}from"./button-Po8_hoCj.js";import{I as x}from"./input-DYNUQEB0.js";import{L as l}from"./label-C5nTzMn2.js";import{I as u}from"./input-error-9cFJtkRf.js";import{R as Q}from"./rich-text-editor-BN0U7LEJ.js";import{Y as U}from"./youtube-AkTWAnDJ.js";import{X as L}from"./x-Cmss8qIq.js";import{I as W}from"./image-B0xc0u5o.js";import{L as ee}from"./loader-circle-3LwKL-vM.js";import"./app-D68BraIN.js";import"./index-DW9AIAM8.js";import"./index-CdSBMCOc.js";import"./index-VNmnc6HY.js";import"./index-BK4guFTW.js";import"./index-XU9KE0KS.js";import"./index-87MTScox.js";import"./createLucideIcon-Duo5QKwh.js";const N=o=>{if(!o)return null;const g=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/^([a-zA-Z0-9_-]{11})$/];for(const b of g){const n=o.match(b);if(n&&n[1])return n[1]}return null},te=o=>`https://img.youtube.com/vi/${o}/maxresdefault.jpg`;function we({gallery:o,trigger:g}){const[b,n]=r.useState(!1),[d,m]=r.useState([]),[h,f]=r.useState(o.photos||[]),[R,C]=r.useState([]),[S,P]=r.useState(o.description||""),[_,j]=r.useState(!1),[E,D]=r.useState(o.media_type||"image_group"),[$,v]=r.useState(o.youtube_url||""),[y,w]=r.useState(o.youtube_url?N(o.youtube_url):null),A=i=>{const t=Array.from(i.target.files||[]).map(s=>({file:s,preview:URL.createObjectURL(s),caption:""}));m(s=>[...s,...t])},k=i=>{m(a=>{const t=[...a];return URL.revokeObjectURL(t[i].preview),t.splice(i,1),t})},G=i=>{f(a=>a.filter(t=>t.id!==i)),C(a=>[...a,i]),j(!0)},Y=(i,a)=>{m(t=>{const s=[...t];return s[i].caption=a,s})},I=(i,a)=>{f(t=>t.map(s=>s.id===i?{...s,caption:a}:s)),j(!0)},V=i=>{v(i);const a=N(i);w(a)},T=()=>{d.forEach(i=>URL.revokeObjectURL(i.preview)),m([]),f(o.photos||[]),C([]),P(o.description||""),j(!1),D(o.media_type||"image_group"),v(o.youtube_url||""),w(o.youtube_url?N(o.youtube_url):null)};return e.jsxs(q,{open:b,onOpenChange:i=>{i||T(),n(i)},children:[e.jsx(z,{asChild:!0,children:g??e.jsx(p,{variant:"outline",children:"Edit"})}),e.jsx(B,{className:"sm:max-w-4xl max-h-[90vh] overflow-y-auto",children:e.jsx(O,{method:"post",action:M.update.url(o.id),encType:"multipart/form-data",onSuccess:()=>{n(!1),T()},className:"space-y-5",children:({processing:i,errors:a})=>e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(J,{children:"Edit Gallery"}),e.jsx(X,{children:"Update the gallery information and photos."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"title",children:"Title"}),e.jsx(x,{id:"title",name:"title",required:!0,defaultValue:o.title,placeholder:"My Photo Gallery",autoFocus:!0}),e.jsx(u,{message:a.title})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"description",children:"Description"}),e.jsx(Q,{value:S,onChange:P,placeholder:"Describe your gallery...",name:"description"}),e.jsx(u,{message:a.description})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"option",children:"Option"}),e.jsxs("select",{id:"option",name:"option",defaultValue:o.option||"",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"",children:"Select an option"}),e.jsx("option",{value:"Abhidh",children:"Abhidh"}),e.jsx("option",{value:"Abhidh Creative",children:"Abhidh Creative"}),e.jsx("option",{value:"Abhidh Academy",children:"Abhidh Academy"})]}),e.jsx(u,{message:a.option})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"media_type",children:"Content Type"}),e.jsxs("select",{id:"media_type",name:"media_type",value:E,onChange:t=>{const s=t.target.value;D(s),s==="youtube"?(d.forEach(c=>URL.revokeObjectURL(c.preview)),m([])):(v(""),w(null))},className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"image_group",children:"Group of Images"}),e.jsx("option",{value:"youtube",children:"YouTube Video"})]}),e.jsx(u,{message:a.media_type})]}),E==="youtube"?e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"youtube_url",children:"YouTube Video URL"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:"youtube_url",name:"youtube_url",type:"url",required:!0,value:$,onChange:t=>V(t.target.value),placeholder:"https://www.youtube.com/watch?v=..."}),e.jsx(U,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Existing photos will be removed when switching to a video gallery."}),y&&e.jsxs("div",{className:"mt-3 rounded-lg border border-primary/20 bg-primary/5 p-4",children:[e.jsx(l,{className:"text-sm font-medium text-foreground mb-2 block",children:"Video Preview"}),e.jsxs("div",{className:"relative aspect-video w-full max-w-md overflow-hidden rounded-lg border",children:[e.jsx("img",{src:te(y),alt:"YouTube video thumbnail",className:"h-full w-full object-cover",onError:t=>{const s=t.target;s.src=`https://img.youtube.com/vi/${y}/hqdefault.jpg`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"rounded-full bg-red-600/90 p-3 shadow-lg",children:e.jsx(U,{className:"h-8 w-8 text-white"})})})]})]}),e.jsx(u,{message:a.youtube_url})]}):e.jsxs(e.Fragment,{children:[h.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{children:"Existing Photos"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:h.map(t=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.photo_url,alt:t.caption||"Gallery photo",className:"w-full h-24 object-cover rounded border"}),e.jsx(p,{type:"button",size:"sm",variant:"destructive",className:"absolute -top-2 -right-2 h-6 w-6 p-0",onClick:()=>G(t.id),children:e.jsx(L,{className:"h-3 w-3"})}),e.jsx(x,{placeholder:"Caption (optional)",value:t.caption||"",onChange:s=>I(t.id,s.target.value),className:"mt-2 text-xs"})]},t.id))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"photos",children:"Add More Photos"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{htmlFor:"photos",className:"inline-flex cursor-pointer items-center gap-2 rounded-md border px-3 py-2 text-sm hover:bg-muted",children:[e.jsx(W,{className:"h-4 w-4"}),"Choose photos"]}),e.jsx("input",{id:"photos",type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:A})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"PNG/JPG up to 2MB each. Select multiple files."}),e.jsx(u,{message:a.photos})]}),d.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{children:"New Photo Previews"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:d.map((t,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.preview,alt:`Preview ${s+1}`,className:"w-full h-24 object-cover rounded border"}),e.jsx(p,{type:"button",size:"sm",variant:"destructive",className:"absolute -top-2 -right-2 h-6 w-6 p-0",onClick:()=>k(s),children:e.jsx(L,{className:"h-3 w-3"})}),e.jsx(x,{placeholder:"Caption (optional)",value:t.caption,onChange:c=>Y(s,c.target.value),className:"mt-2 text-xs"})]},s))})]}),_&&h.map(t=>e.jsx("input",{type:"hidden",name:`existing_photos[${t.id}][id]`,value:t.id},`existing-${t.id}`)),_&&h.map(t=>e.jsx("input",{type:"hidden",name:`existing_photos[${t.id}][caption]`,value:t.caption||""},`existing-caption-${t.id}`)),R.map(t=>e.jsx("input",{type:"hidden",name:"deleted_photos[]",value:t},`deleted-${t}`)),d.map((t,s)=>e.jsx("input",{type:"file",name:"photos[]",style:{display:"none"},ref:c=>{if(c){const F=new DataTransfer;F.items.add(t.file),c.files=F.files}}},`photo-${s}`)),d.map((t,s)=>e.jsx("input",{type:"hidden",name:`captions[${s}]`,value:t.caption},`caption-${s}`))]}),e.jsxs(Z,{className:"gap-2 sm:gap-0",children:[e.jsx(K,{asChild:!0,children:e.jsx(p,{type:"button",variant:"outline",disabled:i,children:"Cancel"})}),e.jsxs(p,{type:"submit",disabled:i,children:[i&&e.jsx(ee,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Gallery"]})]})]})})})]})}export{we as default};
